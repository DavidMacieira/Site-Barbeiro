<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <title>Painel Barbeiro - Jo√£o Angeiras Barbearia</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* Estilos espec√≠ficos para admin */
    .admin-container { padding-top: 100px; background: #121212; min-height: 100vh; }
    .admin-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
    .stat-card { background: #1a1a1a; padding: 20px; border-radius: 8px; text-align: center; border-top: 3px solid #d4af37; }
    .stat-card h3 { font-size: 2rem; color: #d4af37; margin-bottom: 5px; }
    .admin-panel { background: #1a1a1a; padding: 30px; border-radius: 8px; margin-top: 20px; }
    .table-container { overflow-x: auto; margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; background: #121212; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #333; }
    th { background: #333; color: white; font-weight: 600; }
    tr:hover { background: rgba(255,255,255,0.05); }
    .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; display: inline-block; }
    .status-pending { background: #ff9800; color: white; }
    .status-confirmed { background: #4CAF50; color: white; }
    .status-completed { background: #2196F3; color: white; }
    .status-cancelled { background: #f44336; color: white; }
    .btn-small { padding: 5px 10px; font-size: 0.8rem; margin: 2px; }
    .btn-danger { background: #f44336; color: white; border: none; }
    .btn-danger:hover { background: #d32f2f; }
    .btn-success { background: #4CAF50; color: white; border: none; }
    .btn-success:hover { background: #388E3C; }
    .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .tab-btn.active { background: #d4af37; color: #121212; }
    .config-section { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #333; }
    .config-section h4 { color: #d4af37; margin-bottom: 15px; }
    .config-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
    
    /* Filtros */
    .filters { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; align-items: flex-end; }
    .filter-group { display: flex; flex-direction: column; }
    .filter-label { color: #fff; margin-bottom: 5px; font-size: 0.9rem; }
    .filter-input { padding: 8px; border-radius: 4px; border: 1px solid #333; background: #121212; color: white; }
    
    /* Loader */
    .loader { border: 3px solid #333; border-top: 3px solid #d4af37; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <!-- Navbar Admin -->
  <nav>
    <div class="container">
      <a href="index.html" class="logo">JO√ÉO <span>ANGEIRAS</span> <small style="font-size: 0.8rem; color: #d4af37;">BARBEIRO</small></a>
      <div class="nav-links">
        <a href="#dashboard">Dashboard</a>
        <a href="#agenda">Agenda</a>
        <a href="#config">Configura√ß√µes</a>
        <button class="btn btn-secondary" onclick="logout()">Sair</button>
      </div>
    </div>
  </nav>

  <div class="admin-container">
    <div class="container">
      <!-- Dashboard -->
      <section id="dashboard">
        <h2 class="section-title">Dashboard</h2>
        
        <div class="admin-stats">
          <div class="stat-card">
            <h3 id="todayBookings">0</h3>
            <p>Hoje</p>
          </div>
          <div class="stat-card">
            <h3 id="weekBookings">0</h3>
            <p>Esta Semana</p>
          </div>
          <div class="stat-card">
            <h3 id="pendingBookings">0</h3>
            <p>Pendentes</p>
          </div>
          <div class="stat-card">
            <h3 id="totalRevenue">0‚Ç¨</h3>
            <p>Receita</p>
          </div>
        </div>

        <div class="admin-panel">
          <h3><i class="fas fa-calendar-alt"></i> Pr√≥ximas Marca√ß√µes (Hoje)</h3>
          <div class="table-container">
            <table id="upcomingBookings">
              <thead>
                <tr>
                  <th>Hora</th>
                  <th>Cliente</th>
                  <th>Telefone</th>
                  <th>Servi√ßo</th>
                  <th>Valor</th>
                  <th>Status</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="upcomingBookingsBody">
                <tr>
                  <td colspan="7" style="text-align: center; padding: 20px;">
                    <div class="loader"></div>
                    <p>Carregando reservas...</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Agenda -->
      <section id="agenda" style="margin-top: 50px;">
        <h2 class="section-title">Agenda Completa</h2>
        
        <div class="admin-panel">
          <div class="filters">
            <div class="filter-group">
              <label class="filter-label">Data:</label>
              <input type="date" id="filterDate" class="filter-input">
            </div>
            <div class="filter-group">
              <label class="filter-label">Status:</label>
              <select id="filterStatus" class="filter-input">
                <option value="">Todos</option>
                <option value="pending">Pendentes</option>
                <option value="confirmed">Confirmados</option>
                <option value="completed">Conclu√≠dos</option>
                <option value="cancelled">Cancelados</option>
              </select>
            </div>
            <div class="filter-group">
              <button class="btn" onclick="loadAllBookings()" style="margin-top: 5px;">
                <i class="fas fa-sync-alt"></i> Atualizar
              </button>
            </div>
            <div class="filter-group">
              <button class="btn btn-success" onclick="addManualBooking()" style="margin-top: 5px;">
                <i class="fas fa-plus"></i> Nova Reserva
              </button>
            </div>
          </div>

          <div class="table-container">
            <table id="allBookings">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Hora</th>
                  <th>Cliente</th>
                  <th>Telefone</th>
                  <th>Servi√ßo</th>
                  <th>Valor</th>
                  <th>Status</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="allBookingsBody">
                <tr>
                  <td colspan="8" style="text-align: center; padding: 40px;">
                    <div class="loader"></div>
                    <p>Carregando agenda...</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Configura√ß√µes -->
      <section id="config" style="margin-top: 50px;">
        <h2 class="section-title">Configura√ß√µes</h2>
        
        <div class="admin-panel">
          <div class="tabs">
            <button class="btn tab-btn active" onclick="openTab('horarios')">Hor√°rios</button>
            <button class="btn tab-btn" onclick="openTab('feriados')">Feriados/F√©rias</button>
            <button class="btn tab-btn" onclick="openTab('whatsapp')">WhatsApp</button>
            <button class="btn tab-btn" onclick="openTab('api')">Sistema</button>
          </div>

          <!-- Hor√°rios -->
          <div id="horarios" class="tab-content active">
            <h3><i class="fas fa-clock"></i> Hor√°rio de Funcionamento</h3>
            
            <div class="config-section">
              <div class="config-grid">
                <div>
                  <label class="filter-label">Abertura:</label>
                  <select id="openTime" class="filter-input">
                    <option value="8">08:00</option>
                    <option value="9" selected>09:00</option>
                    <option value="10">10:00</option>
                  </select>
                </div>
                <div>
                  <label class="filter-label">Fecho:</label>
                  <select id="closeTime" class="filter-input">
                    <option value="18">18:00</option>
                    <option value="19" selected>19:00</option>
                    <option value="20">20:00</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="config-section">
              <label class="filter-label">Intervalo de Almo√ßo:</label>
              <div class="config-grid">
                <div>
                  <label style="color: #aaa;">In√≠cio:</label>
                  <select id="breakStart" class="filter-input">
                    <option value="12" selected>12:00</option>
                    <option value="13">13:00</option>
                  </select>
                </div>
                <div>
                  <label style="color: #aaa;">Fim:</label>
                  <select id="breakEnd" class="filter-input">
                    <option value="13">13:00</option>
                    <option value="14" selected>14:00</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="config-section">
              <label class="filter-label">Dias de Trabalho:</label>
              <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <label style="color: #aaa; cursor: pointer;">
                  <input type="checkbox" name="workingDays" value="2" checked> Segunda
                </label>
                <label style="color: #aaa; cursor: pointer;">
                  <input type="checkbox" name="workingDays" value="3" checked> Ter√ßa
                </label>
                <label style="color: #aaa; cursor: pointer;">
                  <input type="checkbox" name="workingDays" value="4" checked> Quarta
                </label>
                <label style="color: #aaa; cursor: pointer;">
                  <input type="checkbox" name="workingDays" value="5" checked> Quinta
                </label>
                <label style="color: #aaa; cursor: pointer;">
                  <input type="checkbox" name="workingDays" value="6" checked> Sexta
                </label>
                <label style="color: #aaa; cursor: pointer;">
                  <input type="checkbox" name="workingDays" value="7" checked> S√°bado
                </label>
                <label style="color: #aaa; cursor: pointer;">
                  <input type="checkbox" name="workingDays" value="1"> Domingo
                </label>
              </div>
            </div>

            <button class="btn" onclick="saveWorkingHours()">
              <i class="fas fa-save"></i> Salvar Hor√°rios
            </button>
          </div>

          <!-- Feriados -->
          <div id="feriados" class="tab-content">
            <h3><i class="fas fa-calendar-times"></i> Bloquear Datas</h3>
            <p style="color: #aaa; margin-bottom: 20px;">Adicione feriados ou per√≠odos de f√©rias.</p>
            
            <div class="config-section">
              <label class="filter-label">Descri√ß√£o:</label>
              <input type="text" id="blockDescription" placeholder="Ex: F√©rias de Ver√£o" class="filter-input">
            </div>
            
            <div class="config-section">
              <label class="filter-label">Tipo:</label>
              <select id="blockType" class="filter-input">
                <option value="single">Data √∫nica</option>
                <option value="range">Per√≠odo</option>
              </select>
            </div>
            
            <div class="config-section">
              <label class="filter-label">Data In√≠cio:</label>
              <input type="date" id="blockStartDate" class="filter-input">
            </div>
            
            <div id="blockEndDateGroup" class="config-section" style="display: none;">
              <label class="filter-label">Data Fim:</label>
              <input type="date" id="blockEndDate" class="filter-input">
            </div>
            
            <button class="btn" onclick="addBlockedDate()">
              <i class="fas fa-ban"></i> Bloquear Data
            </button>
            
            <h4 style="margin-top: 40px; margin-bottom: 20px;">Datas Bloqueadas:</h4>
            <div class="table-container">
              <table id="blockedDatesTable">
                <thead>
                  <tr>
                    <th>Descri√ß√£o</th>
                    <th>Data(s)</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody id="blockedDatesBody">
                  <tr>
                    <td colspan="3" style="text-align: center; padding: 20px; color: #aaa;">
                      Carregando datas bloqueadas...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- WhatsApp -->
          <div id="whatsapp" class="tab-content">
            <h3><i class="fab fa-whatsapp"></i> Configura√ß√£o WhatsApp</h3>
            
            <div class="config-section">
              <label class="filter-label">N√∫mero do WhatsApp:</label>
              <input type="text" id="whatsappNumber" value="+351919241169" placeholder="+351912345678" class="filter-input">
              <p style="color: #aaa; font-size: 0.9rem; margin-top: 5px;">Este n√∫mero receber√° as mensagens de marca√ß√£o</p>
            </div>
            
            <div class="config-section">
              <label class="filter-label">Mensagem Padr√£o:</label>
              <textarea id="whatsappMessage" class="filter-input" rows="4" placeholder="Digite a mensagem padr√£o...">‚úÖ NOVA MARCA√á√ÉO - Barbearia Jo√£o Angeiras

üë§ Cliente: {nome}
üì± Telefone: {telefone}
‚úÇÔ∏è Servi√ßo: {servico}
üí∞ Pre√ßo: {pre√ßo}‚Ç¨
üìÖ Data: {data}
üïê Hor√°rio: {hora}

Por favor, confirme esta marca√ß√£o.</textarea>
            </div>
            
            <button class="btn" onclick="saveWhatsAppSettings()">
              <i class="fas fa-save"></i> Salvar Configura√ß√µes
            </button>
          </div>

          <!-- Sistema -->
          <div id="api" class="tab-content">
            <h3><i class="fas fa-cogs"></i> Status do Sistema</h3>
            
            <div class="config-section">
              <div id="apiStatus" style="padding: 20px; background: #1a1a1a; border-radius: 8px;">
                <div class="loader" style="margin: 0 auto 10px;"></div>
                <p style="text-align: center;">Verificando conex√£o com o sistema...</p>
              </div>
            </div>
            
            <div class="config-section">
              <h4>URL da API:</h4>
              <code id="apiUrl" style="display: block; padding: 10px; background: #121212; border: 1px solid #333; border-radius: 4px; margin: 10px 0; color: #aaa; word-break: break-all;"></code>
              <p style="color: #aaa; font-size: 0.9rem;">Esta URL conecta o site ao Google Sheets</p>
            </div>
            
            <div class="config-section">
              <h4>Dados do Sistema:</h4>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                <div style="background: #121212; padding: 15px; border-radius: 5px;">
                  <h5 style="color: #d4af37; margin-bottom: 5px;">Reservas Totais</h5>
                  <p id="totalBookings" style="font-size: 1.5rem; font-weight: bold;">0</p>
                </div>
                <div style="background: #121212; padding: 15px; border-radius: 5px;">
                  <h5 style="color: #d4af37; margin-bottom: 5px;">Servi√ßos</h5>
                  <p id="totalServices" style="font-size: 1.5rem; font-weight: bold;">3</p>
                </div>
              </div>
            </div>
            
            <button class="btn" onclick="testAPIConnection()" style="margin-right: 10px;">
              <i class="fas fa-redo"></i> Testar Conex√£o
            </button>
            
            <button class="btn btn-secondary" onclick="clearCache()">
              <i class="fas fa-trash"></i> Limpar Cache
            </button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Modal Nova Reserva Manual -->
  <div id="manualBookingModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeManualBookingModal()">&times;</span>
      <h2><i class="fas fa-plus"></i> Nova Reserva Manual</h2>
      
      <div class="form-group">
        <label>Nome do Cliente *</label>
        <input type="text" id="manualClientName" placeholder="Nome do cliente" class="filter-input">
      </div>

      <div class="form-group">
        <label>Telefone *</label>
        <input type="tel" id="manualClientPhone" placeholder="912 345 678" class="filter-input">
      </div>

      <div class="form-group">
        <label>Servi√ßo *</label>
        <select id="manualServiceSelect" class="filter-input">
          <option value="">Selecione um servi√ßo</option>
          <option value="Corte de Cabelo|11|30">Corte de Cabelo - 11‚Ç¨ (30 min)</option>
          <option value="Barba|5|20">Barba - 5‚Ç¨ (20 min)</option>
          <option value="Corte + Barba|15|50">Corte + Barba - 15‚Ç¨ (50 min)</option>
        </select>
      </div>

      <div class="form-group">
        <label>Data *</label>
        <input type="date" id="manualBookingDate" class="filter-input">
      </div>

      <div class="form-group">
        <label>Hor√°rio *</label>
        <input type="time" id="manualBookingTime" class="filter-input" step="1800">
      </div>

      <div class="form-group">
        <label>Status</label>
        <select id="manualBookingStatus" class="filter-input">
          <option value="pending">Pendente</option>
          <option value="confirmed">Confirmado</option>
          <option value="completed">Conclu√≠do</option>
        </select>
      </div>

      <div class="form-group">
        <label>Notas</label>
        <textarea id="manualBookingNotes" class="filter-input" rows="3" placeholder="Notas adicionais..."></textarea>
      </div>

      <button class="btn btn-success" onclick="saveManualBooking()">
        <i class="fas fa-save"></i> Salvar Reserva
      </button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <script src="js/api.js"></script>
  <script src="js/admin.js"></script>
</body>
</html>